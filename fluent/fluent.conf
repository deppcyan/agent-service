
<source>
  @type tail
  path /app/log/app.log        # 输入的日志文件路径
  pos_file /var/log/fluent/app.log.pos  # 用于存储读取位置的文件
  tag img2img.logs                # 日志标签，用于标识输入的日志流
  format none                 # 文本格式
</source>

<match img2img.logs>
  @type s3
  aws_key_id "#{ENV['AWS_ACCESS_KEY_ID']}" # 替换为你的 AWS Access Key
  aws_sec_key "#{ENV['AWS_SECRET_ACCESS_KEY']}" # 替换为你的 AWS Secret Key
  s3_bucket externals-logs          # S3 存储桶名称
  s3_region us-west-1              # S3 区域（例如 us-east-1）
  path "agent/#{ENV['DIGEN_SERVICE_IP'] || 'default'}/" # 上传到 S3 的路径前缀
  time_slice_format %Y/%m/%d/   # 按时间切片文件夹
  <buffer time>
    @type file
    path /var/log/fluent/s3
    timekey 300           # 5分钟
    timekey_wait 30        # 等待30秒后上传
    chunk_limit_size 1m
    flush_interval 5s    
  </buffer>  
</match>

